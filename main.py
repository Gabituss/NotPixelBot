import requests
import json
import time
import random

url = 'https://notpx.app/api/v1/repaint/start'
start = 448111

m = [
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '#', '#',
     '#', '#', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#',
     '#', '#', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '#', '#', '.', '.', '.', '.', '.', '.',
     '.', '.', '#', '#', '#', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.',
     '.', '.', '.', '.', '.', '#', '#', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.',
     '.', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*',
     '*', '*', '*', '*', '*', '.', '.', '.', '.', '#', '#', '#', '#', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*',
     '*', '*', '*', '*', '*', '*', '*', '.', '.', '.', '#', '#', '#', '#', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '.', '*', '*', '*', '.', '.', '.', '.', '*', '*', '*', '*',
     '.', '.', '.', '*', '*', '*', '*', '.', '.', '.', '.', '#', '#', '#', '#', ' ', ' '],
    [' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '.', '.', '*', '*', '*', '.', '.', '.', '*', '*', '*', '*',
     '.', '.', '.', '*', '*', '*', '.', '.', '.', '.', '.', '.', '#', '#', '#', ' ', ' '],
    [' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '*', '*', '*', '.', '.', '*', '*', '*', '*',
     '.', '.', '*', '*', '*', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', ' ', ' '],
    [' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '*', '*', '*', '.', '*', '*', '*', '*',
     '.', '*', '*', '*', '.', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', ' ', ' '],
    [' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '*', '*', '*', '*', '*', '*', '*',
     '*', '*', '*', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', ' ', ' '],
    [' ', ' ', ' ', ' ', '#', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '*', '*', '*', '*', '*', '*',
     '*', '*', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', '#', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '*', '*', '*', '*', '*',
     '*', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', '#', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '*', '*', '*', '*',
     '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', '#', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.',
     '.', '.', '.', '.', '.', '.', '.', '.', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.',
     '.', '.', '.', '.', '.', '#', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '#', '#', '#', '.', '.', '.', '.', '.',
     '.', '#', '#', '#', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '#', '#', '#', '#',
     '#', '#', '#', '#', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
    [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ',
     ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
]

c = {
    '#': "#000000",
    '.': "#FFFFFF",
    '*': "#000000"
}


def main(auth, savep):
    next_pixel, x, y = savep
    headers = {
        'authorization': auth
    }
    g = requests.get("https://notpx.app/api/v1/mining/claim", headers=headers)
    print("claim", g.json())

    def getcolor(pixel):
        urlp = "https://notpx.app/api/v1/image/get/"
        responsep = requests.get(urlp + str(pixel), headers=headers)
        g = responsep.json()['pixel']['color']
        return g

    def next(x, y, next_pixel):
        if x < len(m[0]) - 1:
            x += 1
            next_pixel += 1
        elif y < len(m) - 1:
            x = 0
            y += 1
            next_pixel -= len(m[0]) - 1000
        else:
            x = 0
            y = 0
            next_pixel -= len(m[0]) - len(m)
            time.sleep(180 + random.randint(60, 180))
        return x, y, next_pixel

    while True:
        print(y, x)
        if m[y][x] == ' ' or getcolor(next_pixel) == c[m[y][x]]:
            print("skip")
            time.sleep(0.01)
            x, y, next_pixel = next(x, y, next_pixel)
            continue
        data = {
            "pixelId": next_pixel,
            "newColor": c[m[y][x]]
        }
        response = requests.post(url, data=json.dumps(data), headers=headers)
        if response.status_code == 400:
            print("sleep")
            return next_pixel, x, y
        else:
            print("OK", response.json())
            x, y, next_pixel = next(x, y, next_pixel)


k = [
    "initData user=%7B%22id%22%3A6305318621%2C%22first_name%22%3A%22Geekman%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22geekX0%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%7D&chat_instance=5438044166153497780&chat_type=sender&auth_date=1725639004&hash=5a5e5ccd670f852758fb186f6e084e26305a90f1080df0c550abf4b82437f99c",
    'initData user=%7B%22id%22%3A1485105394%2C%22first_name%22%3A%22smn%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22smy_name%22%2C%22language_code%22%3A%22en%22%2C%22allows_write_to_pm%22%3Atrue%7D&chat_instance=-466847157591453414&chat_type=sender&auth_date=1725608357&hash=c56438662280d01d92efdd966a54cd7783c92f31dab915871ddfbc10137bd0c1',
    'initData user=%7B%22id%22%3A1431751865%2C%22first_name%22%3A%22%D0%A1%D0%B0%D0%BC%D0%B0%D1%82%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22samat_que%22%2C%22language_code%22%3A%22en%22%2C%22allows_write_to_pm%22%3Atrue%7D&chat_instance=7167255971921566636&chat_type=sender&auth_date=1725640632&hash=ba0523b1c46d3f8059d39a159dc2d97fedaf02227f81151e914947d9871ec4a5',
    'initData user=%7B%22id%22%3A1945380517%2C%22first_name%22%3A%22dzhalil%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22ZiganshinDzhalil%22%2C%22language_code%22%3A%22ru%22%2C%22allows_write_to_pm%22%3Atrue%7D&chat_instance=6472019921340618234&chat_type=sender&auth_date=1725640368&hash=ed419dc960a0019322880b54c2215d517f56d48aae580e89877637a2704885b1',
    'initData user=%7B%22id%22%3A1173441935%2C%22first_name%22%3A%22Gabitov%22%2C%22last_name%22%3A%22Shamil%22%2C%22username%22%3A%22gabitg%22%2C%22language_code%22%3A%22en%22%2C%22allows_write_to_pm%22%3Atrue%7D&chat_instance=-6154619231545217215&chat_type=sender&auth_date=1725642904&hash=ca600dd6ac727a0962484d15a8c81ac6f3eba0742165cb2e41aca4c9ea371d39'
]
save = start
xs = 0
ys = 0
while True:
    for i in k:
        save, xs, ys = main(i, [save, xs, ys])
    time.sleep(180 * 10 + random.randint(5, 27))
